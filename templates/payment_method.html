{% extends "base.html" %}
{% load static %}
{% block title %}Payment Method{% endblock %}

{% block content %}
<style>
  /* same background as profile/dashboard */
  body{
    margin:0;
    min-height:100vh;
    font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
    background:
      linear-gradient(rgba(0,0,0,.58), rgba(0,0,0,.78)),
      url("{% static 'img/SL-012322-48100-03.jpg' %}") center / cover no-repeat fixed !important;
    color:#fff;
  }

  .wrap{
    align-items:flex-start !important;
    justify-content:center !important;
    padding-top:80px !important;
  }

  .box{
    width:min(520px, 94vw);
    margin:0 auto;
    padding:14px 14px 92px;
    box-sizing:border-box;
  }

  .cardx{
    position: relative;
    background: rgba(30, 34, 34, 0.56);
    border-radius: 18px;
    padding: 18px;
    backdrop-filter: blur(18px);
    -webkit-backdrop-filter: blur(18px);
    box-shadow: 0 18px 55px rgba(0,0,0,.55), inset 0 1px 0 rgba(255,255,255,.08);
    overflow:hidden;
  }
  .cardx::before{
    content:"";
    position:absolute;
    inset:0;
    padding:6px;
    border-radius:18px;
    background: linear-gradient(
      135deg,
      rgba(255,255,255,.38),
      rgba(255,255,255,.08),
      rgba(160,255,200,.16),
      rgba(255,255,255,.06)
    );
    -webkit-mask: linear-gradient(#000 0 0) content-box, linear-gradient(#000 0 0);
    -webkit-mask-composite: xor;
    mask-composite: exclude;
    pointer-events:none;
  }

  .title{
    font-weight:950;
    font-size:18px;
    margin:0 0 6px;
  }
  .sub{
    font-size:12px;
    opacity:.8;
    margin:0 0 14px;
  }

  .field{ margin-top:10px; }
  label{
    display:block;
    font-weight:800;
    font-size:12px;
    margin-bottom:6px;
    opacity:.9;
  }
  input, select{
    width:100%;
    height:44px;
    border-radius:12px;
    border:1px solid rgba(255,255,255,.18);
    background: rgba(0,0,0,.22);
    color:#fff;
    padding:0 12px;
    outline:none;
    box-sizing:border-box;
  }

  .btn{
    width:100%;
    height:46px;
    margin-top:14px;
    border:0;
    border-radius:999px;
    background: linear-gradient(90deg, #0da84c, #27dd75);
    color:#fff;
    font-weight:950;
    letter-spacing:.04em;
    cursor:pointer;
    box-shadow: 0 10px 26px rgba(0,0,0,.35);
  }

  .back{
    display:inline-block;
    margin-top:12px;
    text-decoration:none;
    color:#bfffd2;
    font-weight:900;
    font-size:13px;
  }

  /* ✅ Make select match dark theme (reduce default blue/white) */
  .input-dark{
    width:100%;
    height:44px;
    border-radius:12px;
    border:1px solid rgba(255,255,255,.18);
    background: rgba(0,0,0,.28);
    color:#fff;
    padding:0 12px;
    outline:none;
    box-sizing:border-box;
    appearance:none;
    -webkit-appearance:none;
    -moz-appearance:none;
  }

  /* dropdown list colors */
  select.input-dark option{
    background:#111;
    color:#fff;
  }

  .pm-grid{
    display:grid;
    grid-template-columns: 1fr 260px;
    gap:14px;
    align-items:start;
  }

  .pm-right{
    background: rgba(0,0,0,.18);
    border: 1px solid rgba(255,255,255,.10);
    border-radius: 16px;
    padding: 12px;
    backdrop-filter: blur(14px);
    -webkit-backdrop-filter: blur(14px);
  }

  /* ✅ phone: stack everything inside the card */
  @media (max-width: 720px){
    .pm-grid{
      grid-template-columns: 1fr;
    }
    .pm-right{
      padding: 0;
      border: 0;
      background: transparent;
    }
  }

  /* ===== Method tabs (fix blue dropdown problem) ===== */
.pm-tabs{
  display:flex;
  gap:10px;
  flex-wrap:wrap;
}
.pm-tab{
  flex:1;
  min-width:120px;
  height:44px;
  border-radius:12px;
  border:1px solid rgba(255,255,255,.18);
  background: rgba(0,0,0,.22);
  color:#fff;
  font-weight:900;
  cursor:pointer;
}
.pm-tab.active{
  border-color: rgba(39,221,117,.75);
  box-shadow: 0 0 0 2px rgba(39,221,117,.18);
  background: rgba(13,168,76,.25);
}
</style>

<div class="box">
  <div class="cardx">
    <h2 class="title">Payment Method</h2>
    <p class="sub">Bind your payment method to continue using payment features.</p>

    <!-- ✅ ONE FORM ONLY -->
    <form method="post" action="" autocomplete="off">
    
      {% csrf_token %}

      <div class="field">
        <label>Method Type</label>
      
        <!-- ✅ custom tabs instead of <select> -->
        <div class="pm-tabs" id="pmTabs">
          <button type="button" class="pm-tab active" data-value="bank">Bank Account</button>
          <button type="button" class="pm-tab" data-value="wallet">Mobile Wallet</button>
          <button type="button" class="pm-tab" data-value="card">Card</button>
        </div>
      
        <!-- ✅ hidden input that stores value for Django -->
        <input type="hidden" id="methodType" name="method_type" value="bank">
      </div>
      
      <div class="pm-grid">
        <!-- LEFT SIDE -->
        <div class="pm-left">
          <div class="field">
            <label>Account / Wallet / Card Number</label>
            <input
              class="input-dark"
              name="number"
              placeholder="Enter number"
              autocomplete="off"
              inputmode="numeric"
            >
          </div>
      
          <div class="field">
            <label>Account Holder Name</label>
            <input class="input-dark" name="holder_name" placeholder="Enter name" autocomplete="off">
          </div>
        </div>
      
        <!-- RIGHT SIDE (CARD ONLY) -->
        <div class="pm-right" id="cardFields" style="display:none;">
          <div class="field">
            <label>Card Expiry (MM/YY)</label>
            <input class="input-dark" id="cardExpiry" name="card_expiry" placeholder="MM/YY" maxlength="5" inputmode="numeric" autocomplete="off">
          </div>
      
          <div class="field">
            <label>CVV</label>
            <input class="input-dark" id="cardCvv" name="card_cvv" placeholder="***" maxlength="4" inputmode="numeric" autocomplete="off">
          </div>
        </div>
      </div>      

      <button class="btn" type="submit">SAVE PAYMENT METHOD</button>
      <a class="back" href="/profile/">← Back to Profile</a>
    </form>

  </div>
</div>

<script>
    (function(){
      const hiddenType = document.getElementById("methodType"); // hidden input
      const tabsWrap = document.getElementById("pmTabs");
      const tabs = Array.from(document.querySelectorAll(".pm-tab"));
      const cardFields = document.getElementById("cardFields");
      const expiry = document.getElementById("cardExpiry");
      const cvv = document.getElementById("cardCvv");
    
      function setType(val){
        hiddenType.value = val;
    
        tabs.forEach(b => b.classList.toggle("active", b.dataset.value === val));
    
        const isCard = (val === "card");
        cardFields.style.display = isCard ? "block" : "none";
    
        if (expiry) expiry.required = isCard;
        if (cvv) cvv.required = isCard;
      }
    
      // click tabs
      if (tabsWrap){
        tabsWrap.addEventListener("click", (e) => {
          const btn = e.target.closest(".pm-tab");
          if (!btn) return;
          setType(btn.dataset.value);
        });
      }
    
      // format expiry MM/YY
      if (expiry){
        expiry.addEventListener("input", () => {
          let v = expiry.value.replace(/[^\d]/g, "").slice(0,4);
          if (v.length >= 3) v = v.slice(0,2) + "/" + v.slice(2);
          expiry.value = v;
        });
      }
    
      // only digits for CVV
      if (cvv){
        cvv.addEventListener("input", () => {
          cvv.value = cvv.value.replace(/[^\d]/g, "").slice(0,4);
        });
      }
    
      // default
      setType(hiddenType.value || "bank");
    })();
    </script>
    

{% endblock %}
